<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher - BookStore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: background 0.3s ease, backdrop-filter 0.3s ease; /* Th√™m transition */
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
            color: white !important;
        }

        .nav-link {
            color: rgba(255,255,255,0.9) !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: white !important;
            transform: translateY(-2px);
        }

        .btn-auth {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .btn-auth:hover {
            background: white;
            color: #667eea;
        }

        .cart-icon {
            position: relative;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* START: CSS CHO CART MODAL (ƒê√É TH√äM) */
        .modal-content {
            border-radius: 15px;
            border: none;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            border-bottom: none;
        }

        .btn-close-white {
            filter: invert(1);
        }

        #cartModal table {
            font-size: 0.9rem;
        }

        #cartModal thead th {
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #667eea;
        }

        #cartModal tbody td {
            border-bottom: 1px solid #e9ecef;
        }

        #cartModal .item-title-link {
            font-size: 0.95rem;
            cursor: pointer;
            color: #343a40;
            text-decoration: none;
        }
        #cartModal .item-title-link:hover {
            color: #667eea;
            text-decoration: underline;
        }

        /* END: CSS CHO CART MODAL */

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
            margin-bottom: 60px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease; /* Th√™m transition cho parallax */
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="voucher" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><text x="10" y="15" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.1)">üé´</text></pattern></defs><rect width="100" height="100" fill="url(%23voucher)"/></svg>');
            opacity: 0.1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .filter-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .filter-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #495057;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 5px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filter-btn:hover, .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .voucher-card {
            background: white;
            border-radius: 20px;
            padding: 0;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
        }

        .voucher-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .voucher-header {
            padding: 25px 30px 20px;
            position: relative;
        }

        .voucher-discount {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 15px 20px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .voucher-discount::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #764ba2;
        }

        .discount-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .discount-type {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .voucher-code {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .code-text {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: scale(1.05);
            color: white;
        }

        .voucher-info {
            padding: 0 30px 25px;
        }

        .voucher-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .voucher-description {
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .voucher-details {
            border-top: 1px solid #e9ecef;
            padding-top: 20px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }

        .detail-icon {
            width: 20px;
            color: #667eea;
            margin-right: 10px;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
            min-width: 120px;
        }

        .detail-value {
            color: #6c757d;
        }

        .voucher-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-ending {
            background: #fff3cd;
            color: #856404;
        }

        .status-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .voucher-category {
            position: absolute;
            top: -10px;
            left: 30px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .countdown-timer {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .timer-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .voucher-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 30px;
        }

        .stats-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
            padding: 20px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 1rem;
        }

        .footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px 0 20px 0;
            margin-top: 60px;
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 60px 0;
            }

            .voucher-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .voucher-header {
                padding: 20px 20px 15px;
            }

            .voucher-info {
                padding: 0 20px 20px;
            }

            .filter-section {
                padding: 20px;
            }

            .stats-section {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}"><i class="fas fa-book-open"></i> BookStore</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">Trang ch·ªß</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/products}">S·∫£n ph·∫©m</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/about}">Gi·ªõi thi·ªáu</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/contact}">Li√™n h·ªá</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" th:href="@{/user/voucher}">Voucher</a>
                </li>
            </ul>

            <div class="d-flex align-items-center" id="authButtons">

                <div id="loggedOutButtons" th:if="${!isLoggedIn}">
                    <a th:href="@{/login}" href="login.html" class="btn btn-auth btn-sm">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p
                    </a>
                    <a th:href="@{/register}" href="register.html" class="btn btn-auth btn-sm">
                        <i class="fas fa-user-plus"></i> ƒêƒÉng k√Ω
                    </a>
                </div>

                <div id="loggedInButtons" th:if="${isLoggedIn}">
                    <div class="dropdown">
                        <button class="btn btn-auth btn-sm dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle"></i>
                            <span id="userNameDisplay" th:text="${currentUser.username}">T√†i kho·∫£n</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                            <li><a class="dropdown-item" th:href="@{/user/profile}">
                                <i class="fas fa-info-circle"></i> Th√¥ng tin c√° nh√¢n
                            </a></li>

                            <li><a class="dropdown-item" th:href="@{/user/profile#address-settings}">
                                <i class="fas fa-map-marked-alt"></i> C·∫≠p nh·∫≠t ƒê·ªãa ch·ªâ
                            </a></li>

                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" th:href="@{/logout}">
                                <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                            </a></li>
                        </ul>
                    </div>
                </div>

                <div class="cart-icon ms-3" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#cartModal">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-badge" id="cartCount">0</span>
                </div>
            </div>
        </div>
    </div>
</nav>

<section class="hero-section">
    <div class="container">
        <div class="hero-content text-center">
            <h1 class="display-3 fw-bold mb-4">
                <i class="fas fa-ticket-alt"></i> Voucher ∆∞u ƒë√£i
            </h1>
            <p class="lead fs-4 mb-5">
                Ti·∫øt ki·ªám h∆°n v·ªõi c√°c m√£ gi·∫£m gi√° h·∫•p d·∫´n
            </p>
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <p class="fs-5 opacity-90">
                        Kh√°m ph√° b·ªô s∆∞u t·∫≠p voucher ƒëa d·∫°ng c·ªßa BookStore. T·ª´ gi·∫£m gi√° s√°ch gi√°o khoa
                        ƒë·∫øn mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn, ch√∫ng t√¥i c√≥ ∆∞u ƒë√£i ph√π h·ª£p cho m·ªçi nhu c·∫ßu h·ªçc t·∫≠p!
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container">
    <div class="stats-section">
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-item">
                    <div class="stat-number" id="totalVouchers">0</div>
                    <div class="stat-label">Voucher kh·∫£ d·ª•ng</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-item">
                    <div class="stat-number">50%</div>
                    <div class="stat-label">Gi·∫£m gi√° t·ªëi ƒëa</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-item">
                    <div class="stat-number">0ƒë</div>
                    <div class="stat-label">Ph√≠ v·∫≠n chuy·ªÉn</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-item">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">H·ªó tr·ª£ s·ª≠ d·ª•ng</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="filter-section">
        <h4 class="mb-3"><i class="fas fa-filter"></i> L·ªçc voucher theo lo·∫°i</h4>
        <div class="d-flex flex-wrap">
            <button class="filter-btn active" onclick="filterVouchers(event, 'all')">
                <i class="fas fa-list"></i> T·∫•t c·∫£
            </button>
            <button class="filter-btn" onclick="filterVouchers(event, 'discount')">
                <i class="fas fa-percentage"></i> Gi·∫£m gi√°
            </button>
            <button class="filter-btn" onclick="filterVouchers(event, 'shipping')">
                <i class="fas fa-shipping-fast"></i> Mi·ªÖn ship
            </button>
            <button class="filter-btn" onclick="filterVouchers(event, 'combo')">
                <i class="fas fa-gift"></i> Combo
            </button>
            <button class="filter-btn" onclick="filterVouchers(event, 'newbie')">
                <i class="fas fa-user-plus"></i> Kh√°ch m·ªõi
            </button>
            <button class="filter-btn" onclick="filterVouchers(event, 'vip')">
                <i class="fas fa-crown"></i> VIP
            </button>
        </div>
    </div>
</div>

<div class="container">
    <div class="voucher-grid" id="voucherGrid">
        <script th:inline="javascript">
            /*<![CDATA[*/
            // Khai b√°o bi·∫øn global ƒë·ªÉ ch·ª©a d·ªØ li·ªáu voucher t·ª´ server
            let VOUCHERS_DATA = JSON.parse(/*[[${vouchersJson}]]*/ '[]');
            /*]]>*/
        </script>
    </div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <h5><i class="fas fa-book-open"></i> BookStore</h5>
                <p>C·ª≠a h√†ng s√°ch h·ªçc t·∫≠p h√†ng ƒë·∫ßu cho h·ªçc sinh c·∫•p 3</p>
                <div class="d-flex">
                    <a href="#" class="text-white me-3"><i class="fab fa-facebook fa-2x"></i></a>
                    <a href="#" class="text-white me-3"><i class="fab fa-instagram fa-2x"></i></a>
                    <a href="#" class="text-white"><i class="fab fa-youtube fa-2x"></i></a>
                </div>
            </div>
            <div class="col-md-4">
                <h5>Li√™n k·∫øt nhanh</h5>
                <ul class="list-unstyled">
                    <li><a th:href="@{/}" class="text-white-50">Trang ch·ªß</a></li>
                    <li><a th:href="@{/products}" class="text-white-50">S·∫£n ph·∫©m</a></li>
                    <li><a th:href="@{/about}" class="text-white-50">Gi·ªõi thi·ªáu</a></li>
                    <li><a th:href="@{/contact}" class="text-white-50">Li√™n h·ªá</a></li>
                </ul>
            </div>
            <div class="col-md-4">
                <h5>Li√™n h·ªá</h5>
                <p><i class="fas fa-phone"></i> 0123 456 789</p>
                <p><i class="fas fa-envelope"></i> info@bookstore.vn</p>
                <p><i class="fas fa-map-marker-alt"></i> ƒê·∫°i h·ªçc C√¥ng nghi·ªáp H√† N·ªôi - C∆° s·ªü 1</p>
            </div>
        </div>
        <hr class="my-4">
        <div class="text-center">
            <p>&copy; 2024 BookStore. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
        </div>
    </div>
</footer>

<div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="cartItems">
                </div>
                <div class="d-flex justify-content-between align-items-center mt-3">
                    <h5>T·ªïng c·ªông: <span id="totalPrice" class="text-danger fw-bold">0ƒë</span></h5>
                    <a th:href="@{/user/cart}" href="/user/cart" id="checkoutBtn" class="btn btn-primary-custom disabled" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                        <i class="fas fa-credit-card"></i> Thanh to√°n (ƒêi ƒë·∫øn gi·ªè h√†ng)
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- 1. D·ªÆ LI·ªÜU M·∫™U V√Ä BI·∫æN GI·ªé H√ÄNG (ƒê√É TH√äM/CH·ªàNH S·ª¨A) ---

    // D·ªØ li·ªáu m·∫´u s·∫£n ph·∫©m (d√πng ƒë·ªÉ tra c·ª©u cho gi·ªè h√†ng)
    const mockProducts = [
        { id: 1, idProducts: 1, title: "To√°n h·ªçc 12 - S√°ch gi√°o khoa", price: 45000, description: "S√°ch gi√°o khoa To√°n h·ªçc l·ªõp 12", icon: "üìö", imageLinks: ['https://via.placeholder.com/250x250/F0F0F0?text=T12']},
        { id: 2, idProducts: 2, title: "V·∫≠t l√Ω 11 - B√†i t·∫≠p n√¢ng cao", price: 65000, description: "B·ªô s√°ch b√†i t·∫≠p V·∫≠t l√Ω n√¢ng cao", icon: "‚ö°", imageLinks: ['https://via.placeholder.com/250x250/F0F0F0?text=L11']},
        { id: 3, idProducts: 3, title: "English Grammar in Use", price: 120000, description: "S√°ch ng·ªØ ph√°p ti·∫øng Anh", icon: "üá¨üáß", imageLinks: ['https://via.placeholder.com/250x250/F0F0F0?text=ENG']},
        { id: 4, idProducts: 4, title: "H√≥a h·ªçc 10 - S√°ch gi√°o khoa", price: 42000, description: "S√°ch gi√°o khoa H√≥a h·ªçc l·ªõp 10", icon: "üß™", imageLinks: ['https://via.placeholder.com/250x250/F0F0F0?text=H10']},
    ];
    // Gi·∫£ ƒë·ªãnh m·ªôt danh s√°ch s·∫£n ph·∫©m chung ƒë·ªÉ getProductById ho·∫°t ƒë·ªông
    const products = mockProducts;

    // Cart data from localStorage
    let cart = JSON.parse(localStorage.getItem('bookstoreCart') || '[]');
    let currentFilter = 'all';

    // --- 2. C√ÅC H√ÄM TI·ªÜN √çCH (ƒê√É TH√äM) ---

    function formatPrice(price) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(price);
    }

    function getProductById(productId) {
        // T√¨m ki·∫øm s·∫£n ph·∫©m trong danh s√°ch tra c·ª©u chung (mockProducts)
        return products.find(p => p.idProducts === productId || p.id === productId);
    }

    function getFirstImageLink(product) {
        // H√†m n√†y ƒë∆∞·ª£c ƒë∆°n gi·∫£n h√≥a cho m·ª•c ƒë√≠ch hi·ªÉn th·ªã trong Modal gi·ªè h√†ng
        // Trong m√¥i tr∆∞·ªùng th·∫≠t, b·∫°n c·∫ßn logic ph·ª©c t·∫°p h∆°n
        if (product && product.imageLinks && product.imageLinks.length > 0) {
            let link = product.imageLinks[0];
            if (typeof link === 'object' && link !== null) {
                return link.image_link || link.imageLink || null;
            }
            return link;
        }
        return null;
    }

    // --- 3. LOGIC GI·ªé H√ÄNG (ƒê√É TH√äM/CH·ªàNH S·ª¨A) ---

    // Update cart count (ƒê·ªïi t√™n h√†m c≈©)
    function updateCartCount() {
        const cartCount = document.getElementById('cartCount');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCount.textContent = totalItems;
        // C·∫≠p nh·∫≠t lu√¥n modal
        updateCartModal();
    }

    function updateCartUI() {
        updateCartCount();
        // C·∫≠p nh·∫≠t c√°c th√†nh ph·∫ßn UI kh√°c n·∫øu c·∫ßn
    }

    function updateQuantityModal(productId, change) {
        const item = cart.find(item => item.idProducts === productId || item.id === productId);
        if (item) {
            let newQuantity = item.quantity + change;

            if (newQuantity < 1) {
                // N·∫øu gi·∫£m xu·ªëng 0, h·ªèi c√≥ mu·ªën x√≥a kh√¥ng (ho·∫∑c ch·ªâ c·∫£nh b√°o)
                showNotification('S·ª≠ d·ª•ng n√∫t x√≥a ƒë·ªÉ lo·∫°i b·ªè ho√†n to√†n s·∫£n ph·∫©m.', 'warning');
                return;
            }

            item.quantity = newQuantity;
            localStorage.setItem('bookstoreCart', JSON.stringify(cart));
            updateCartUI();
        }
    }

    function removeFromCart(productId) {
        cart = cart.filter(item => item.idProducts !== productId && item.id !== productId);
        localStorage.setItem('bookstoreCart', JSON.stringify(cart));
        updateCartUI();
        showNotification('ƒê√£ x√≥a kh·ªèi gi·ªè h√†ng!', 'info');
    }


    /**
     * Modal Gi·ªè h√†ng hi·ªÉn th·ªã chi ti·∫øt s·∫£n ph·∫©m (·∫£nh, t√™n, gi√°, s·ªë l∆∞·ª£ng, th√†nh ti·ªÅn).
     */
    function updateCartModal() {
        const cartItems = document.getElementById('cartItems');
        const totalPrice = document.getElementById('totalPrice');
        const checkoutBtn = document.getElementById('checkoutBtn');

        let total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

        if (cart.length === 0) {
            cartItems.innerHTML = '<p class="text-center text-muted p-4">Gi·ªè h√†ng t·∫°m th·ªùi ƒëang tr·ªëng.</p>';
            totalPrice.textContent = '0ƒë';
            checkoutBtn.classList.add('disabled');
            return;
        }

        // S·ª¨ D·ª§NG C·∫§U TR√öC TABLE CHO CƒÇN CH·ªàNH T·ªêT NH·∫§T
        let cartHTML = `
            <table class="table align-middle">
                <thead class="table-light">
                    <tr>
                        <th scope="col" style="width: 35%;">S·∫£n ph·∫©m</th>
                        <th scope="col" style="width: 15%;">ƒê∆°n gi√°</th>
                        <th scope="col" style="width: 25%;" class="text-center">S·ªë l∆∞·ª£ng</th>
                        <th scope="col" style="width: 15%;" class="text-end">Th√†nh ti·ªÅn</th>
                        <th scope="col" style="width: 10%;"></th>
                    </tr>
                </thead>
                <tbody>
        `;

        cart.forEach(item => {
            const itemId = item.idProducts;
            // S·ª≠ d·ª•ng item.imageLink ƒë√£ l∆∞u ho·∫∑c placeholder
            const imgSource = item.imageLink || 'https://via.placeholder.com/60x60/DEDEDE?text=Book';
            const subtotal = item.price * item.quantity;

            cartHTML += `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="${imgSource}" alt="${item.title}" loading="lazy" style="width: 60px; height: 60px; object-fit: contain; border-radius: 5px; margin-right: 15px; border: 1px solid #eee;">
                            <div>
                                <a href="/products/${itemId}" class="item-title-link" >
                                    <h6 class="mb-0">${item.title}</h6>
                                </a>
                            </div>
                        </div>
                    </td>
                    <td><small class="text-muted">${formatPrice(item.price)}</small></td>
                    <td class="text-center">
                        <div class="d-flex align-items-center justify-content-center">
                            <button class="btn btn-sm btn-outline-secondary me-1" onclick="updateQuantityModal(${itemId}, -1)">-</button>
                            <span class="mx-1 fw-bold">${item.quantity}</span>
                            <button class="btn btn-sm btn-outline-secondary ms-1" onclick="updateQuantityModal(${itemId}, 1)">+</button>
                        </div>
                    </td>
                    <td class="text-end fw-bold text-danger">${formatPrice(subtotal)}</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${itemId})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        });

        cartHTML += `
                </tbody>
            </table>
        `;

        cartItems.innerHTML = cartHTML;
        totalPrice.textContent = formatPrice(total);
        checkoutBtn.classList.remove('disabled');
    }


    // --- 4. LOGIC VOUCHER G·ªêC (GI·ªÆ NGUY√äN) ---

    // Load page on startup
    document.addEventListener('DOMContentLoaded', function() {
        updateCartUI(); // G·ªçi h√†m n√†y ƒë·ªÉ c·∫≠p nh·∫≠t Gi·ªè h√†ng
        renderVouchers();
        startCountdowns();
        animateOnScroll();
    });

    // Render vouchers
    function renderVouchers() {
        const grid = document.getElementById('voucherGrid');
        // D√πng VOUCHERS_DATA l·∫•y t·ª´ server
        const filteredVouchers = currentFilter === 'all' ? VOUCHERS_DATA : VOUCHERS_DATA.filter(v => v.type === currentFilter);

        grid.innerHTML = filteredVouchers.map(voucher => `
            <div class="voucher-card" data-type="${voucher.type}">
                <div class="voucher-category">${voucher.category}</div>
                <div class="voucher-status status-${voucher.status}">
                    ${voucher.status === 'active' ? 'C√≤n hi·ªáu l·ª±c' :
            voucher.status === 'ending' ? 'S·∫Øp h·∫øt h·∫°n' : 'H·∫øt h·∫°n'}
                </div>

                <div class="voucher-header">
                    <div class="voucher-discount">
                        <div class="discount-value">${voucher.discountValue}</div>
                        <div class="discount-type">${voucher.discountType}</div>
                    </div>

                    <div class="voucher-code">
                        <div class="code-text">${voucher.code}</div>
                        <button class="copy-btn" onclick="copyVoucherCode('${voucher.code}')">
                            <i class="fas fa-copy"></i> Copy m√£
                        </button>
                    </div>
                </div>

                <div class="voucher-info">
                    <h4 class="voucher-title">${voucher.title}</h4>
                    <p class="voucher-description">${voucher.description}</p>

                    <div class="voucher-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar detail-icon"></i>
                            <span class="detail-label">H·∫øt h·∫°n:</span>
                            <span class="detail-value">${voucher.endDateDisplay}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-shopping-cart detail-icon"></i>
                            <span class="detail-label">ƒê∆°n t·ªëi thi·ªÉu:</span>
                            <span class="detail-value">${voucher.minOrderDisplay}</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-ticket-alt detail-icon"></i>
                            <span class="detail-label">C√≤n l·∫°i:</span>
                            <span class="detail-value">${voucher.quantity} voucher</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-info-circle detail-icon"></i>
                            <span class="detail-label">ƒêi·ªÅu ki·ªán:</span>
                            <span class="detail-value">${voucher.requirements}</span>
                        </div>
                    </div>

                    ${voucher.status === 'ending' ? `
                        <div class="countdown-timer" id="countdown-${voucher.id}">
                            <div>‚è∞ C√≤n l·∫°i: <span class="timer-value" id="timer-${voucher.id}">--:--:--</span></div>
                        </div>
                    ` : ''}
                </div>
            </div>
        `).join('');

        // Update total vouchers count
        document.getElementById('totalVouchers').textContent = filteredVouchers.length;
    }

    // Filter vouchers
    function filterVouchers(event, type) {
        currentFilter = type;

        // Update active filter button
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        renderVouchers();
        startCountdowns();
    }

    // Copy voucher code
    function copyVoucherCode(code) {
        navigator.clipboard.writeText(code).then(() => {
            showNotification(`ƒê√£ copy m√£ voucher: ${code}`, 'success');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = code;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification(`ƒê√£ copy m√£ voucher: ${code}`, 'success');
        });
    }

    // Start countdown timers
    function startCountdowns() {
        const endingVouchers = VOUCHERS_DATA.filter(v => v.status === 'ending');

        endingVouchers.forEach(voucher => {
            const timerElement = document.getElementById(`timer-${voucher.id}`);
            if (timerElement) {
                updateCountdown(voucher.endDate, timerElement);
                // Clear existing interval before setting a new one (Ph√≤ng ng·ª´a)
                const existingInterval = timerElement.dataset.intervalId;
                if (existingInterval) {
                    clearInterval(parseInt(existingInterval));
                }

                const intervalId = setInterval(() => updateCountdown(voucher.endDate, timerElement), 1000);
                timerElement.dataset.intervalId = intervalId;
            }
        });
    }

    // Update countdown
    function updateCountdown(endDate, element) {
        const now = new Date().getTime();
        // JS d√πng format yyyy-MM-dd ƒë·ªÉ t·∫°o date object
        const end = new Date(endDate).getTime();
        const distance = end - now;

        if (distance > 0) {
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            element.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        } else {
            element.textContent = 'ƒê√£ h·∫øt h·∫°n';
            // Ng·ª´ng ƒë·∫øm ng∆∞·ª£c
            clearInterval(parseInt(element.dataset.intervalId));
        }
    }

    // Show notification
    function showNotification(message, type) {
        const notification = document.createElement('div');
        const alertClass = type === 'success' ? 'alert-success' :
            type === 'error' ? 'alert-danger' :
                type === 'info' ? 'alert-info' : 'alert-warning';

        notification.className = `alert ${alertClass} position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            if (notification.parentElement) {
                notification.remove();
            }
        }, 3000);
    }

    // Animate elements on scroll
    function animateOnScroll() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe all voucher cards for animation
        document.querySelectorAll('.voucher-card, .stats-section, .filter-section').forEach(element => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(30px)';
            element.style.transition = 'all 0.6s ease';
            observer.observe(element);
        });
    }

    // Add scroll effect to navbar
    window.addEventListener('scroll', function() {
        const navbar = document.querySelector('.navbar');
        if (window.scrollY > 100) {
            // Hi·ªáu ·ª©ng m·ªù nh·∫π
            navbar.style.background = 'linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%)';
            navbar.style.backdropFilter = 'blur(5px)';
        } else {
            navbar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            navbar.style.backdropFilter = 'none';
        }
    });

    // Add parallax effect to hero section
    window.addEventListener('scroll', function() {
        const hero = document.querySelector('.hero-section');
        const scrolled = window.pageYOffset;
        // Chia 2 ƒë·ªÉ gi·∫£m t·ªëc ƒë·ªô cu·ªôn
        const rate = scrolled * -0.2;

        if (hero) {
            hero.style.transform = `translateY(${rate}px)`;
        }
    });

</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98aa36ac02d708dd',t:'MTc1OTgwNjcxMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>